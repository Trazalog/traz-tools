<data enableBatchRequests="true" enableBoxcarring="true" name="TARDataService" transports="http https local">
   <config enableOData="false" id="produccionDS">
      <property name="carbon_datasource_name">ToolsDataSource</property>
   </config>
   <query id="getTareas" useConfig="produccionDS">
      <sql>SELECT * FROM tst.tareas_std&#xd;WHERE empr_id = CAST(:empr_id as integer)&#xd;AND not eliminado&#xd;ORDER BY nombre</sql>
      <result outputType="json">{&#xd;    "tareas":{&#xd;       "tarea":[&#xd;           {&#xd;            "tare_id":"$tare_id",&#xd;            "nombre":"$nombre",&#xd;            "descripcion":"$descripcion",&#xd;            "duracion":"$duracion",&#xd;            "form_id":"$form_id",&#xd;            "rece_id":"$rece_id",&#xd;            "proc_id":"$proc_id"&#xd;           }&#xd;       ] &#xd;    }&#xd;}</result>
      <param name="empr_id" sqlType="STRING"/>
   </query>
   <query id="getTarea" useConfig="produccionDS">
      <sql>SELECT *&#xd;FROM tst.tareas_std&#xd;WHERE tare_id = CAST(:tare_id as integer)&#xd;AND not eliminado</sql>
      <result outputType="json">{&#xd;    "tareas":{&#xd;       "tarea":[&#xd;           {&#xd;            "tare_id":"$tare_id",&#xd;            "nombre":"$nombre",&#xd;            "descripcion":"$descripcion",&#xd;            "duracion":"$duracion",&#xd;            "form_id":"$form_id",&#xd;            "rece_id":"$rece_id",&#xd;            "proc_id":"$proc_id"&#xd;           }&#xd;       ] &#xd;    }&#xd;}</result>
      <param name="tare_id" sqlType="STRING"/>
   </query>
   <query id="setTarea" useConfig="produccionDS">
      <sql>INSERT INTO tst.tareas_std(nombre, descripcion, duracion, form_id, rece_id, proc_id, empr_id)&#xd;select :nombre,&#xd;:descripcion,&#xd;:duracion,&#xd;case when param.form_id is null or param.form_id = '' then null else cast( param.form_id as integer) end,&#xd;case when param.rece_id is null or param.rece_id = '' then null else cast( param.rece_id as integer) end,&#xd;:proc_id,&#xd;cast(:empr_id as integer)&#xd;from (select :form_id form_id, :rece_id rece_id) param;</sql>
      <param name="nombre" sqlType="STRING"/>
      <param name="descripcion" sqlType="STRING"/>
      <param name="duracion" sqlType="STRING"/>
      <param name="form_id" sqlType="STRING"/>
      <param name="rece_id" sqlType="STRING"/>
      <param name="proc_id" sqlType="STRING"/>
      <param name="empr_id" sqlType="STRING"/>
   </query>
   <query id="updateTarea" useConfig="produccionDS">
      <sql>UPDATE tst.tareas_std&#xd;SET nombre=:nombre, descripcion=:descripcion, duracion=:duracion, form_id= CAST(:form_id as integer), rece_id= CAST(:rece_id as integer), proc_id=:proc_id&#xd;WHERE tare_id=CAST(:tare_id as integer)</sql>
      <param name="nombre" sqlType="STRING"/>
      <param name="descripcion" sqlType="STRING"/>
      <param name="duracion" sqlType="STRING"/>
      <param name="form_id" sqlType="STRING"/>
      <param name="rece_id" sqlType="STRING"/>
      <param name="proc_id" sqlType="STRING"/>
      <param name="tare_id" sqlType="STRING"/>
   </query>
   <query id="deleteTarea" useConfig="produccionDS">
      <sql>UPDATE tst.tareas_std&#xd;SET eliminado = true&#xd;WHERE tare_id=CAST(:tare_id as integer)</sql>
      <param name="tare_id" sqlType="STRING"/>
   </query>
   <query id="getSubtareas" useConfig="produccionDS">
      <sql>SELECT * &#xd;FROM tst.subtareas&#xd;WHERE tare_id = CAST(:tare_id as integer)&#xd;AND not eliminado</sql>
      <result outputType="json">{&#xd;  "subtareas": {&#xd;    "subtarea": [&#xd;      {&#xd;        "suta_id": "$suta_id",&#xd;        "nombre": "$nombre",&#xd;        "descripcion": "$descripcion",&#xd;        "duracion": "$duracion",&#xd;        "tare_id": "$tare_id",&#xd;        "form_id": "$form_id"&#xd;      }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="tare_id" sqlType="STRING"/>
   </query>
   <query id="getSubtarea" useConfig="produccionDS">
      <sql>SELECT *&#xd;FROM tst.subtareas&#xd;WHERE suta_id = CAST(:suta_id as integer)</sql>
      <result outputType="json">{&#xd;  "subtareas": {&#xd;    "subtarea": [&#xd;      {&#xd;        "suta_id": "$suta_id",&#xd;        "nombre": "$nombre",&#xd;        "descripcion": "$descripcion",&#xd;        "duracion": "$duracion",&#xd;        "tare_id": "$tare_id",&#xd;        "form_id": "$form_id"&#xd;      }&#xd;    ]&#xd;  }&#xd;}&#xd;</result>
      <param name="suta_id" sqlType="STRING"/>
   </query>
   <query id="setSubtarea" useConfig="produccionDS">
      <sql>INSERT INTO tst.subtareas&#xd;(nombre,descripcion, duracion,tare_id, form_id)&#xd;select :nombre, &#xd;:descripcion, &#xd;:duracion, &#xd;CAST(:tare_id as integer), &#xd;case when param.form_id is null or param.form_id = '' then null else cast(param.form_id as integer) end&#xd;from (select :form_id form_id) param;</sql>
      <param name="descripcion" sqlType="STRING"/>
      <param name="tare_id" sqlType="STRING"/>
      <param name="form_id" sqlType="STRING"/>
      <param name="nombre" sqlType="STRING"/>
      <param name="duracion" sqlType="STRING"/>
   </query>
   <query id="updateSubtarea" useConfig="produccionDS">
      <sql>UPDATE tst.subtareas&#xd;SET nombre=:nombre, descripcion=:descripcion, tare_id=CAST(:tare_id as integer), form_id=CAST(:form_id as integer)&#xd;WHERE suta_id= CAST(:suta_id as integer)</sql>
      <param name="nombre" sqlType="STRING"/>
      <param name="descripcion" sqlType="STRING"/>
      <param name="tare_id" sqlType="STRING"/>
      <param name="form_id" sqlType="STRING"/>
      <param name="suta_id" sqlType="STRING"/>
   </query>
   <query id="deleteSubtarea" useConfig="produccionDS">
      <sql>UPDATE tst.subtareas&#xd;SET eliminado = true&#xd;WHERE suta_id= CAST(:suta_id as integer)</sql>
      <param name="suta_id" sqlType="STRING"/>
   </query>
   <query id="getPlantillas" useConfig="produccionDS">
      <sql>SELECT *&#xd;FROM tst.plantillas&#xd;WHERE empr_id = CAST(:empr_id as integer)&#xd;AND not eliminado&#xd;ORDER BY nombre</sql>
      <result outputType="json">{&#xd;  "plantillas": {&#xd;    "plantilla": [&#xd;      {&#xd;        "plan_id": "$plan_id",&#xd;        "nombre": "$nombre",&#xd;        "@getTareasPlantilla":$plan_id-&gt;plan_id&#xd;      }&#xd;    ]&#xd;  }&#xd;}&#xd;</result>
      <param name="empr_id" sqlType="STRING"/>
   </query>
   <query id="getPlantilla" useConfig="produccionDS">
      <sql>SELECT * &#xd;FROM tst.plantillas&#xd;WHERE plan_id = CAST(:plan_id as integer)</sql>
      <result outputType="json">{&#xd;  "plantillas": {&#xd;    "plantilla": [&#xd;      {&#xd;        "plan_id": "$plan_id",&#xd;        "nombre": "$nombre"&#xd;      }&#xd;    ]&#xd;  }&#xd;}&#xd;</result>
      <param name="plan_id" sqlType="STRING"/>
   </query>
   <query id="setPlantilla" useConfig="produccionDS">
      <sql>INSERT INTO tst.plantillas&#xd;(nombre, empr_id)&#xd;VALUES(:nombre, CAST(:empr_id as integer))</sql>
      <param name="nombre" sqlType="STRING"/>
      <param name="empr_id" sqlType="STRING"/>
   </query>
   <query id="updatePlantilla" useConfig="produccionDS">
      <sql>UPDATE tst.plantillas&#xd;SET nombre= :nombre&#xd;WHERE plan_id = CAST(:plan_id as integer)</sql>
      <param name="nombre" sqlType="STRING"/>
      <param name="plan_id" sqlType="STRING"/>
   </query>
   <query id="deletePlantilla" useConfig="produccionDS">
      <sql>UPDATE tst.plantillas&#xd;SET eliminado = true&#xd;WHERE plan_id = CAST(:plan_id as integer)</sql>
      <param name="plan_id" sqlType="STRING"/>
   </query>
   <query id="asociarPlantillaTarea" useConfig="produccionDS">
      <sql>INSERT INTO tst.rel_plantillas_tareas&#xd;(plan_id, tare_id)&#xd;VALUES(CAST(:plan_id as integer), CAST(:tare_id as integer));</sql>
      <param name="plan_id" sqlType="STRING"/>
      <param name="tare_id" sqlType="STRING"/>
   </query>
   <query id="deletePlantillaTarea" useConfig="produccionDS">
      <sql>DELETE&#xd;FROM tst.rel_plantillas_tareas&#xd;WHERE plan_id = CAST(:plan_id as integer)&#xd;AND tare_id = CAST(:tare_id as integer)</sql>
      <param name="plan_id" sqlType="STRING"/>
      <param name="tare_id" sqlType="STRING"/>
   </query>
   <query id="getTareasPlantilla" useConfig="produccionDS">
      <sql>SELECT TS.* FROM TST.REL_PLANTILLAS_TAREAS RPT , TST.TAREAS_STD TS &#xd;WHERE RPT.TARE_ID = TS.TARE_ID AND PLAN_ID = CAST(:plan_id AS INTEGER) AND NOT TS.ELIMINADO</sql>
      <result outputType="json">{&#xd;    "tareas":{&#xd;       "tarea":[&#xd;           {&#xd;            "tare_id":"$tare_id",&#xd;            "nombre":"$nombre",&#xd;            "descripcion":"$descripcion",&#xd;            "duracion":"$duracion",&#xd;            "form_id":"$form_id",&#xd;            "rece_id":"$rece_id",&#xd;            "proc_id":"$proc_id"&#xd;           }&#xd;       ] &#xd;    }&#xd;}</result>
      <param name="plan_id" sqlType="STRING"/>
   </query>
   <query id="setTareaPlanificada" useConfig="produccionDS">
      <sql>insert&#xd;	into&#xd;	tst.tareas_planificadas (tapl_id,&#xd;	nombre,&#xd;	fecha,&#xd;	user_id,&#xd;	info_id,&#xd;	case_id,&#xd;	tare_id,&#xd;	proc_id,&#xd;	form_id,&#xd;	descripcion,&#xd;	rece_id,&#xd;	fec_inicio,&#xd;	fec_fin,&#xd;	hora_duracion,&#xd;	empr_id)&#xd;select&#xd;	case&#xd;		when param.id is null or param.id = ''&#xd;		 then nextval('tst.tareas_planificadas_tapl_id_seq') else cast(param.id as integer) end ,&#xd;		:nombre,&#xd;		to_date(:fecha, 'YYYY-MM-DD'),&#xd;		case when param.user_id is null or param.user_id ='' then null else param.user_id end,&#xd;		case when param.info_id is null or param.info_id ='' then null else cast(param.info_id as integer) end,&#xd;		case when param.case_id is null or param.case_id ='' then null else cast(param.case_id as integer) end,&#xd;		case when param.tare_id is null or param.tare_id ='' then null else cast(param.tare_id as integer) end,&#xd;		:proc_id,&#xd;		case when param.form_id is null or param.form_id ='' then null else cast(param.form_id as integer) end,&#xd;		:descripcion,&#xd;		case when param.rece_id is null or param.rece_id ='' then null else cast(param.rece_id as integer) end,&#xd;		to_timestamp(:fec_inicio, 'YYYY-MM-DD HH24:MI:SS'),&#xd;		to_timestamp(:fec_fin, 'YYYY-MM-DD HH24:MI:SS'),&#xd;		:hora_duracion,&#xd;		cast(:empr_id as integer)&#xd;	from&#xd;		(&#xd;		select&#xd;			:tapl_id id&#xd;			,:user_id user_id&#xd;			,:info_id info_Id&#xd;			,:case_id case_id&#xd;			,:tare_id tare_id&#xd;			,:form_id form_id&#xd;			,:rece_id rece_id&#xd;			) as param &#xd;			on&#xd;		conflict (tapl_id) do&#xd;update&#xd;set&#xd;	nombre = excluded.nombre,&#xd;	fecha = excluded.fecha,&#xd;	user_id = case when excluded.user_id is null then null else excluded.user_id end,&#xd;	info_id = case when excluded.info_id is null then null else cast( excluded.info_id as integer)end,&#xd;	case_id = case when excluded.case_id is null then null else cast( excluded.case_id as integer) end,&#xd;	tare_id = case when excluded.tare_id is null then null else cast( excluded.tare_id as integer) end,&#xd;	proc_id = excluded.proc_id,&#xd;	form_id = case when excluded.form_id is null then null else cast( excluded.form_id as integer) end,&#xd;	descripcion = excluded.descripcion,&#xd;	rece_id = case when excluded.rece_id is null then null else cast( excluded.rece_id as integer) end,&#xd;	fec_inicio = excluded.fec_inicio,&#xd;	fec_fin = excluded.fec_fin,&#xd;	hora_duracion = excluded.hora_duracion,&#xd;	empr_id = excluded.empr_id &#xd;	returning tapl_id;</sql>
      <result outputType="json">{"respuesta":{"tapl_id":"$tapl_id"}}</result>
      <param name="nombre" sqlType="STRING"/>
      <param name="fecha" sqlType="STRING"/>
      <param name="user_id" sqlType="STRING"/>
      <param name="case_id" sqlType="STRING"/>
      <param name="tare_id" sqlType="STRING"/>
      <param name="info_id" sqlType="STRING"/>
      <param name="tapl_id" sqlType="STRING"/>
      <param name="proc_id" sqlType="STRING"/>
      <param name="form_id" sqlType="STRING"/>
      <param name="descripcion" sqlType="STRING"/>
      <param name="rece_id" sqlType="STRING"/>
      <param name="fec_inicio" sqlType="STRING"/>
      <param name="fec_fin" sqlType="STRING"/>
      <param name="hora_duracion" sqlType="STRING"/>
      <param name="empr_id" sqlType="STRING"/>
   </query>
   <query id="updateTareaPlanificada" useConfig="produccionDS">
      <sql>update tst.tareas_planificadas &#xd;    set&#xd;        nombre = :nombre,&#xd;        fecha = TO_DATE(:fecha,'YYYY-MM-DD'),&#xd;        hora =:hora,&#xd;        user_id = :user_id,&#xd;        equi_id = cast(:equi_id as integer),&#xd;        case_id = cast(:case_id as integer),&#xd;        tare_id = cast(:tare_id as integer)&#xd;    where tapl_id = CAST(:tapl_id as integer);</sql>
      <param name="nombre" sqlType="STRING"/>
      <param name="fecha" sqlType="STRING"/>
      <param name="hora" sqlType="STRING"/>
      <param name="user_id" sqlType="STRING"/>
      <param name="equi_id" sqlType="STRING"/>
      <param name="case_id" sqlType="STRING"/>
      <param name="tare_id" sqlType="STRING"/>
      <param name="tapl_id" sqlType="STRING"/>
   </query>
   <query id="deleteTareaPlanificada" useConfig="produccionDS">
      <sql>UPDATE tst.tareas_planificadas&#xd;SET eliminado = true&#xd;WHERE tapl_id = CAST(:tapl_id as integer)</sql>
      <param name="tapl_id" sqlType="STRING"/>
   </query>
   <query id="deleteTareaRecuros" useConfig="produccionDS">
      <sql>DELETE FROM tst.recursos_tareas&#xd;WHERE tapl_id  = CAST(:tapl_id as integer)</sql>
      <param name="tapl_id" sqlType="STRING"/>
   </query>
   <query id="setTareaRecursos" useConfig="produccionDS">
      <sql>INSERT INTO tst.recursos_tareas&#xd;(tapl_id, recu_id)&#xd;VALUES(cast(:tapl_id as integer), cast(:recu_id as integer));</sql>
      <param name="tapl_id" sqlType="STRING"/>
      <param name="recu_id" sqlType="STRING"/>
   </query>
   <query id="getTareasPlanificadas" useConfig="produccionDS">
      <sql>select tp.tapl_id , tp.nombre ,to_char(tp.fecha, 'DD-MM-YYYY') fecha, tp.user_id, tp.equi_id, tp.case_id, tp.tare_id, tp.proc_id, tp.form_id, tp.rece_id, tp.info_id, tp.eliminado, tp.estado,to_char(tp.fec_inicio,'DD-MM-YYYY+HH12:MI:SS') fec_inicio,to_char(fec_fin,'DD-MM-YYYY+HH12:MI:SS') fec_fin, tp.descripcion,tp.hora_duracion &#xd;from tst.origen_tarea_planficada otp &#xd;join tst.tareas_planificadas tp &#xd;on otp.tapl_id = tp.tapl_id &#xd;where otp.origen = :origen&#xd;and otp.orta_id = cast(:orta_id as integer)&#xd;and not eliminado&#xd;order by tp.tapl_id</sql>
      <result outputType="json">{&#xd;  "tareas": {&#xd;    "tarea": [&#xd;        {&#xd;            "tapl_id":"$tapl_id",&#xd;            "nombre":"$nombre",&#xd;            "user_id":"$user_id",&#xd;            "info_id":"$info_id",&#xd;            "case_id":"$case_id",&#xd;            "tare_id":"$tare_id",&#xd;            "fecha":"$fecha",&#xd;            "fec_inicio":"$fec_inicio",&#xd;            "fec_fin":"$fec_fin",&#xd;            "proc_id":"$proc_id",&#xd;            "form_id":"$form_id",&#xd;            "rece_id":"$rece_id",&#xd;            "estado":"$estado",&#xd;            "descripcion":"$descripcion",&#xd;            "duracion":"$hora_duracion",&#xd;            "@getTareaRecursos":$tapl_id-&gt;tapl_id&#xd;         }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="orta_id" sqlType="STRING"/>
      <param name="origen" sqlType="STRING"/>
   </query>
   <query id="getTareaRecursos" useConfig="produccionDS">
      <sql>select r.*, e.codigo &#xd;from tst.recursos_tareas rt &#xd;join prd.recursos r&#xd;on rt.recu_id = r.recu_id &#xd;join core.equipos e &#xd;on e.equi_id = r.equi_id &#xd;where rt.tapl_id = cast(:tapl_id as integer)</sql>
      <result outputType="json">{&#xd;  "recursos": {&#xd;    "recurso": [&#xd;        {&#xd;            "recu_id":"$recu_id",&#xd;            "tipo":"$tipo",&#xd;            "equi_id":"$equi_id",&#xd;            "arti_id":"$arti_id",&#xd;            "codigo":"$codigo"&#xd;        }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="tapl_id" sqlType="STRING"/>
   </query>
   <query id="setTareaOrigen" useConfig="produccionDS">
      <sql>INSERT INTO tst.origen_tarea_planficada&#xd;(origen, tapl_id, orta_id)&#xd;VALUES(:origen, cast(:tapl_id as integer), cast(:orta_id as integer))&#xd;ON CONFLICT(origen, tapl_id, orta_id) DO NOTHING</sql>
      <param name="origen" sqlType="STRING"/>
      <param name="tapl_id" sqlType="STRING"/>
      <param name="orta_id" sqlType="STRING"/>
   </query>
   <query id="getSectores" useConfig="produccionDS">
      <sql>select *&#xd;from core.tablas t&#xd;where t.tabla = 'sectores'</sql>
      <result outputType="json">{&#xd;  "sectores": {&#xd;    "sector": [&#xd;        {&#xd;            "sect_id":"$tabl_id",&#xd;            "nombre":"$valor",&#xd;            "descripcion":"$descripcion",&#xd;            "@getEquiposXSector":"$sect_id-&gt;tabl_id"&#xd;        }&#xd;    ]&#xd;  }&#xd;}</result>
   </query>
   <query id="getEquiposXSector" useConfig="produccionDS">
      <sql>select r.recu_id, e.*&#xd;from core.equipos e&#xd;join prd.recursos r&#xd;on e.equi_id = r.equi_id&#xd;where sect_id = :sect_id</sql>
      <result outputType="json">{&#xd;  "equipos": {&#xd;    "equipo": [&#xd;        {&#xd;            "recu_id": "$recu_id",&#xd;            "equi_id":"$equi_id",&#xd;            "descripcion":"$descripcion",&#xd;            "marca":"$marca",&#xd;            "codigo":"$codigo"&#xd;        }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="sect_id" sqlType="STRING"/>
   </query>
   <query id="setEstadoTarea" useConfig="produccionDS">
      <sql>UPDATE&#xd;tst.tareas_planificadas&#xd;SET estado = :estado&#xd;WHERE tapl_id = cast(:tapl_id as integer)</sql>
      <param name="estado" sqlType="STRING"/>
      <param name="tapl_id" sqlType="STRING"/>
   </query>
   <query id="getTareaPlanificadaXCaseId" useConfig="produccionDS">
      <sql>SELECT * FROM tst.tareas_planificadas tp&#xd;JOIN tst.origen_tarea_planficada otp on otp.tapl_id = tp.tapl_id&#xd;WHERE tp.case_id = :case_id</sql>
      <result outputType="json">{&#xd;  "tareas": {&#xd;    "tarea": [&#xd;        {&#xd;            "tapl_id":"$tapl_id",&#xd;            "nombre":"$nombre",&#xd;            "user_id":"$user_id",&#xd;            "info_id":"$info_id",&#xd;            "case_id":"$case_id",&#xd;            "tare_id":"$tare_id",&#xd;            "fecha":"$fecha",&#xd;            "origen":"$origen",&#xd;            "orta_id":"$orta_id",&#xd;            "proc_id":"$proc_id",&#xd;            "estado":"$estado",&#xd;            "descripcion":"$descripcion",&#xd;            "@getTareaRecursos":"$tapl_id-&gt;tapl_id",&#xd;            "@getSubtareas":"$tare_id-&gt;tare_id"&#xd;         }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="case_id" sqlType="STRING"/>
   </query>
   <query id="getTareasEventos" useConfig="produccionDS">
      <sql>select to_char(fec_inicio,'YYYY-MM-DD+HH12:MI:SS') as dia_inicio, concat(extract(hour from fec_inicio),':', extract(minute from fec_inicio)) as hora_inicio,to_char(fec_fin,'YYYY-MM-DD+HH12:MI:SS') as dia_fin,&#xd;hora_duracion, nombre as titulo, descripcion, tapl_id as even_id&#xd;from tst.tareas_planificadas tp where tp.fec_inicio is not null and tp.fec_fin is not null and not tp.eliminado and tp.empr_id = cast(:empr_id as integer)</sql>
      <result outputType="json">{&#xd;  "eventos": {&#xd;    "evento": [&#xd;        {&#xd;            "even_id":"$even_id",&#xd;            "titulo":"$titulo",&#xd;            "descripcion":"$descripcion",&#xd;            "dia_inicio":"$dia_inicio",&#xd;            "hora_inicio":"$hora_inicio",&#xd;            "hora_duracion":"$hora_duracion",&#xd;            "dia_fin":"$dia_fin"&#xd;        }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="empr_id" sqlType="STRING"/>
   </query>
   <query id="delTareasSinOrigen" useConfig="produccionDS">
      <sql>delete from tst.tareas_planificadas tp where tapl_id not in (select otp.tapl_id from tst.origen_tarea_planficada otp) and tp.empr_id = cast(:empr_id as integer)</sql>
      <param name="empr_id" sqlType="STRING"/>
   </query>
   <query id="setHito" useConfig="produccionDS">
      <sql>INSERT INTO tst.hitos&#xd;(numero, descripcion, fec_inicio, user_id, objetivo, unidad_tiempo, esta_id, documento, petr_id, nombre_documento)&#xd;VALUES (:numero, :descripcion, TO_DATE(:fec_inicio, 'YYYY-MM-DD'), :user_id, cast(:objetivo as integer), :unidad_tiempo, cast(:esta_id as integer), cast(:documento as bytea), cast(:petr_id as integer), :nombre_documento)</sql>
      <param name="numero" sqlType="STRING"/>
      <param name="fec_inicio" sqlType="STRING"/>
      <param name="objetivo" sqlType="STRING"/>
      <param name="esta_id" sqlType="STRING"/>
      <param name="petr_id" sqlType="STRING"/>
      <param name="descripcion" sqlType="STRING"/>
      <param name="user_id" sqlType="STRING"/>
      <param name="unidad_tiempo" sqlType="STRING"/>
      <param name="documento" sqlType="STRING"/>
      <param name="nombre_documento" sqlType="STRING"/>
   </query>
   <query id="getHitos" useConfig="produccionDS">
      <sql>SELECT numero, descripcion, fec_inicio, user_id, objetivo, unidad_tiempo, esta_id, documento, petr_id, hito_id&#xd;FROM tst.hitos h&#xd;where h.petr_id = cast(:petr_id as integer)&#xd;and not h.eliminado</sql>
      <result outputType="json">{&#xd;  "hitos": {&#xd;    "hito": [&#xd;      {&#xd;        "numero": "$numero",&#xd;        "descripcion": "$descripcion",&#xd;        "fec_inicio": "$fec_inicio",&#xd;        "user_id": "$user_id",&#xd;        "objetivo": "$objetivo",&#xd;        "unidad_tiempo": "$unidad_tiempo",&#xd;        "esta_id": "$esta_id",&#xd;        "documento": "$documento",&#xd;        "petr_id": "$petr_id",&#xd;        "hito_id": "$hito_id"&#xd;      }&#xd;    ]&#xd;  }&#xd;}&#xd;</result>
      <param name="petr_id" sqlType="STRING"/>
   </query>
   <query id="getHito" useConfig="produccionDS">
      <sql>SELECT numero, descripcion, fec_inicio, user_id, objetivo, unidad_tiempo, esta_id, documento, petr_id, hito_id&#xd;FROM tst.hitos&#xd;WHERE not eliminado&#xd;and hito_id = cast(:hito_id as integer);</sql>
      <result outputType="json">{&#xd;  "hitos": {&#xd;    "hito": [&#xd;        {&#xd;            "numero": "$numero",&#xd;            "descripcion": "$descripcion",&#xd;            "fec_inicio": "$fec_inicio",&#xd;            "user_id": "$user_id",&#xd;            "objetivo": "$objetivo",&#xd;            "unidad_tiempo": "$unidad_tiempo",&#xd;            "esta_id": "$esta_id",&#xd;            "documento": "$documento",&#xd;            "petr_id": "$petr_id",&#xd;            "hito_id": "$hito_id"&#xd;        }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="hito_id" sqlType="STRING"/>
   </query>
   <query id="getPetrIdXHitoId" useConfig="produccionDS">
      <sql>select H.petr_id from tst.hitos H&#xd;where H.hito_id = cast(:hito_id as Integer)</sql>
      <result outputType="json">{ &#xd; "pedidoTrabajoId":{&#xd;    "petr_id": "$petr_id"&#xd;  }&#xd;} </result>
      <param name="hito_id" sqlType="STRING"/>
   </query>
   <query id="getKpiBasico" useConfig="produccionDS">
      <sql>select to_char(tp.fec_inicio,'YYYY-MM-DD HH12:MI:SS') fec_inicio, to_char(tp.fec_fin,'YYYY-MM-DD HH12:MI:SS') fec_fin, tp.tapl_id, tp.user_id, &#xd;case when tp.fec_inicio = to_timestamp('3000-12-31 00:00:00','YYYY-MM-DD HH24:MI:SS') then 0 else 1 end cant_inicio,&#xd;case when tp.fec_fin = to_timestamp('3000-12-31 00:00:00','YYYY-MM-DD HH24:MI:SS') then 0 else 1 end cant_fin,&#xd;pt.petr_id,&#xd;pt.clie_id,&#xd;core.clientes.nombre AS nombre_cliente,&#xd;u.id AS id_usuario,&#xd;u.first_name || ' ' || u.last_name as nombre_usuario &#xd;FROM tst.tareas_planificadas AS tp&#xd;INNER JOIN tst.origen_tarea_planficada AS otp ON otp.tapl_id = tp.tapl_id and otp.origen = 'PETR'&#xd;INNER JOIN tst.hitos AS h ON h.hito_id = otp.orta_id&#xd;INNER JOIN pro.pedidos_trabajo AS pt ON h.petr_id = pt.petr_id&#xd;LEFT JOIN core.clientes ON pt.clie_id = core.clientes.clie_id&#xd;LEFT JOIN seg.users u ON tp.user_id = u.usernick,&#xd;(select :empr_id empr_id, :usuario usuario, :cliente cliente, :desde desde, :hasta hasta) filtro  &#xd;WHERE tp.fec_inicio &lt;&gt; to_timestamp('3000-12-31 00:00:00','YYYY-MM-DD HH24:MI:SS') AND&#xd; tp.empr_id  = CAST (filtro.empr_id AS integer) AND &#xd;u.id = case when filtro.usuario is null or filtro.usuario ='' then u.id else  CAST (filtro.usuario AS integer) end and&#xd;pt.clie_id =  case when filtro.cliente is null or filtro.cliente ='' then pt.clie_id  else CAST (filtro.cliente AS integer) end and&#xd;tp.fec_inicio &gt;= case when filtro.desde is null or filtro.desde = '' then tp.fec_inicio else to_timestamp(filtro.desde,'YYYY-MM-DD HH24:MI:SS') end and&#xd;tp.fec_fin &lt;= case when filtro.hasta is null or filtro.hasta = '' then tp.fec_fin else to_timestamp(filtro.hasta,'YYYY-MM-DD HH24:MI:SS') end</sql>
      <result outputType="json">{&#xd;    "tareas": {&#xd;        "tarea": [&#xd;            {&#xd;		"tapl_id": "$tapl_id",&#xd;                "petr_id": "$petr_id",&#xd;                "clie_id": "$clie_id",&#xd;                "nombre_usuario": "$nombre_usuario",&#xd;		"user_id": "$user_id",&#xd;                "nombre_cliente": "$nombre_cliente",&#xd;                "fec_inicio": "$fec_inicio",&#xd;                "fec_fin": "$fec_fin",&#xd;                "cant_inicio": "$cant_inicio",&#xd;                "cant_fin": "$cant_fin"&#xd;            }&#xd;        ]&#xd;    }&#xd;}</result>
      <param name="empr_id" sqlType="STRING"/>
      <param name="usuario" sqlType="STRING"/>
      <param name="cliente" sqlType="STRING"/>
      <param name="desde" sqlType="STRING"/>
      <param name="hasta" sqlType="STRING"/>
   </query>
   <query id="getTareaPlanificada" useConfig="produccionDS">
      <sql>select * from tst.tareas_planificadas&#xd;WHERE tapl_id = CAST(:tapl_id as integer)</sql>
      <result outputType="json">{&#xd;  "tareaPlanificada": {&#xd;   &#xd;        "tapl_id": "$tapl_id",&#xd;        "proc_id": "$proc_id",&#xd;        "case_id": "$case_id" &#xd;    &#xd;  }&#xd;}&#xd;</result>
      <param name="tapl_id" sqlType="STRING"/>
   </query>
   <query id="updateFec_inicio_TareaPlanificada" useConfig="produccionDS">
      <sql>UPDATE tst.tareas_planificadas&#xd;SET fec_inicio = TO_TIMESTAMP(:fec_inicio,'YYYY-MM-DD HH24:MI:SS'),&#xd;estado = :estado&#xd;WHERE case_id=:case_id</sql>
      <param name="fec_inicio" sqlType="STRING"/>
      <param name="case_id" sqlType="STRING"/>
      <param name="estado" sqlType="STRING"/>
   </query>
   <query id="updateFec_fin_TareaPlanificada" useConfig="produccionDS">
      <sql>UPDATE tst.tareas_planificadas&#xd;SET fec_fin = TO_TIMESTAMP(:fec_fin,'YYYY-MM-DD HH24:MI:SS'),&#xd;estado = :estado&#xd;WHERE case_id=:case_id</sql>
      <param name="fec_fin" sqlType="STRING"/>
      <param name="case_id" sqlType="STRING"/>
      <param name="estado" sqlType="STRING"/>
   </query>
   <query id="getTareasXRecursos" useConfig="produccionDS">
      <sql>select to_char(fec_inicio,'YYYY-MM-DD+HH12:MI:SS') as dia_inicio, concat(extract(hour from fec_inicio),':', extract(minute from fec_inicio)) as hora_inicio,&#xd;to_char(fec_fin,'YYYY-MM-DD+HH12:MI:SS') as dia_fin, hora_duracion, nombre as titulo, tp.descripcion, tp.tapl_id as even_id&#xd;from tst.tareas_planificadas tp, tst.recursos_tareas rt, prd.recursos r, core.equipos e&#xd;where tp.fec_inicio is not null &#xd;and tp.fec_fin is not null &#xd;and not tp.eliminado &#xd;and tp.empr_id = cast(:empr_id as integer)&#xd;and tp.tapl_id = rt.tapl_id&#xd;and rt.recu_id = r.recu_id&#xd;and r.equi_id = e.equi_id&#xd;and e.equi_id = any(array[ :rec_id_list ])&#xd;group by tp.tapl_id</sql>
      <result outputType="json">{&#xd;  "eventos": {&#xd;    "evento": [&#xd;        {&#xd;            "even_id":"$even_id",&#xd;            "titulo":"$titulo",&#xd;            "descripcion":"$descripcion",&#xd;            "dia_inicio":"$dia_inicio",&#xd;            "hora_inicio":"$hora_inicio",&#xd;            "hora_duracion":"$hora_duracion",&#xd;            "dia_fin":"$dia_fin"&#xd;        }&#xd;    ]&#xd;  }&#xd;}</result>
      <param name="empr_id" sqlType="STRING"/>
      <param name="rec_id_list" optional="false" paramType="ARRAY" sqlType="INTEGER"/>
   </query>
   <resource method="GET" path="/tareas/{empr_id}">
      <call-query href="getTareas">
         <with-param name="empr_id" query-param="empr_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tareas/obtener/{tare_id}">
      <call-query href="getTarea">
         <with-param name="tare_id" query-param="tare_id"/>
      </call-query>
   </resource>
   <resource method="POST" path="/tareas">
      <call-query href="setTarea">
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="descripcion" query-param="descripcion"/>
         <with-param name="duracion" query-param="duracion"/>
         <with-param name="form_id" query-param="form_id"/>
         <with-param name="rece_id" query-param="rece_id"/>
         <with-param name="proc_id" query-param="proc_id"/>
         <with-param name="empr_id" query-param="empr_id"/>
      </call-query>
   </resource>
   <resource method="PUT" path="/tareas">
      <call-query href="updateTarea">
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="descripcion" query-param="descripcion"/>
         <with-param name="duracion" query-param="duracion"/>
         <with-param name="form_id" query-param="form_id"/>
         <with-param name="rece_id" query-param="rece_id"/>
         <with-param name="proc_id" query-param="proc_id"/>
         <with-param name="tare_id" query-param="tare_id"/>
      </call-query>
   </resource>
   <resource method="DELETE" path="/tareas">
      <call-query href="deleteTarea">
         <with-param name="tare_id" query-param="tare_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/subtareas/{tare_id}">
      <call-query href="getSubtareas">
         <with-param name="tare_id" query-param="tare_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/subtareas/obtener/{suta_id}">
      <call-query href="getSubtarea">
         <with-param name="suta_id" query-param="suta_id"/>
      </call-query>
   </resource>
   <resource method="POST" path="/subtareas">
      <call-query href="setSubtarea">
         <with-param name="descripcion" query-param="descripcion"/>
         <with-param name="tare_id" query-param="tare_id"/>
         <with-param name="form_id" query-param="form_id"/>
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="duracion" query-param="duracion"/>
      </call-query>
   </resource>
   <resource method="PUT" path="/subtareas">
      <call-query href="updateSubtarea">
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="descripcion" query-param="descripcion"/>
         <with-param name="tare_id" query-param="tare_id"/>
         <with-param name="form_id" query-param="form_id"/>
         <with-param name="suta_id" query-param="suta_id"/>
      </call-query>
   </resource>
   <resource method="DELETE" path="/subtareas">
      <call-query href="deleteSubtarea">
         <with-param name="suta_id" query-param="suta_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/plantillas/{empr_id}">
      <call-query href="getPlantillas">
         <with-param name="empr_id" query-param="empr_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/plantillas/obtener/{plan_id}">
      <call-query href="getPlantilla">
         <with-param name="plan_id" query-param="plan_id"/>
      </call-query>
   </resource>
   <resource method="POST" path="/plantillas">
      <call-query href="setPlantilla">
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="empr_id" query-param="empr_id"/>
      </call-query>
   </resource>
   <resource method="PUT" path="/plantillas">
      <call-query href="updatePlantilla">
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="plan_id" query-param="plan_id"/>
      </call-query>
   </resource>
   <resource method="DELETE" path="/plantillas">
      <call-query href="deletePlantilla">
         <with-param name="plan_id" query-param="plan_id"/>
      </call-query>
   </resource>
   <resource method="POST" path="/plantillas/tareas">
      <call-query href="asociarPlantillaTarea">
         <with-param name="plan_id" query-param="plan_id"/>
         <with-param name="tare_id" query-param="tare_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/plantillas/tareas/{plan_id}">
      <call-query href="getTareasPlantilla">
         <with-param name="plan_id" query-param="plan_id"/>
      </call-query>
   </resource>
   <resource method="DELETE" path="/plantillas/tareas">
      <call-query href="deletePlantillaTarea">
         <with-param name="plan_id" query-param="plan_id"/>
         <with-param name="tare_id" query-param="tare_id"/>
      </call-query>
   </resource>
   <resource method="PUT" path="/tarea/planificar">
      <call-query href="updateTareaPlanificada">
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="fecha" query-param="fecha"/>
         <with-param name="hora" query-param="hora"/>
         <with-param name="user_id" query-param="user_id"/>
         <with-param name="equi_id" query-param="equi_id"/>
         <with-param name="case_id" query-param="case_id"/>
         <with-param name="tare_id" query-param="tare_id"/>
         <with-param name="tapl_id" query-param="tapl_id"/>
      </call-query>
   </resource>
   <resource method="POST" path="/tarea/planificar">
      <call-query href="setTareaPlanificada">
         <with-param name="nombre" query-param="nombre"/>
         <with-param name="fecha" query-param="fecha"/>
         <with-param name="user_id" query-param="user_id"/>
         <with-param name="case_id" query-param="case_id"/>
         <with-param name="tare_id" query-param="tare_id"/>
         <with-param name="info_id" query-param="info_id"/>
         <with-param name="tapl_id" query-param="tapl_id"/>
         <with-param name="proc_id" query-param="proc_id"/>
         <with-param name="form_id" query-param="form_id"/>
         <with-param name="descripcion" query-param="descripcion"/>
         <with-param name="rece_id" query-param="rece_id"/>
         <with-param name="fec_inicio" query-param="fec_inicio"/>
         <with-param name="fec_fin" query-param="fec_fin"/>
         <with-param name="hora_duracion" query-param="hora_duracion"/>
         <with-param name="empr_id" query-param="empr_id"/>
      </call-query>
   </resource>
   <resource method="DELETE" path="/tarea/planificar">
      <call-query href="deleteTareaPlanificada">
         <with-param name="tapl_id" query-param="tapl_id"/>
      </call-query>
   </resource>
   <resource method="DELETE" path="/tarea/recursos">
      <call-query href="deleteTareaRecuros">
         <with-param name="tapl_id" query-param="tapl_id"/>
      </call-query>
   </resource>
   <resource method="POST" path="/tarea/recursos">
      <call-query href="setTareaRecursos">
         <with-param name="tapl_id" query-param="tapl_id"/>
         <with-param name="recu_id" query-param="recu_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tareas/planificar/{origen}/{orta_id}">
      <call-query href="getTareasPlanificadas">
         <with-param name="orta_id" query-param="orta_id"/>
         <with-param name="origen" query-param="origen"/>
      </call-query>
   </resource>
   <resource method="POST" path="/tarea/origen">
      <call-query href="setTareaOrigen">
         <with-param name="origen" query-param="origen"/>
         <with-param name="tapl_id" query-param="tapl_id"/>
         <with-param name="orta_id" query-param="orta_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/sectores">
      <call-query href="getSectores"/>
   </resource>
   <resource method="PUT" path="/tareas/estado">
      <call-query href="setEstadoTarea">
         <with-param name="estado" query-param="estado"/>
         <with-param name="tapl_id" query-param="tapl_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tareas/planificadas/case/{case_id}">
      <call-query href="getTareaPlanificadaXCaseId">
         <with-param name="case_id" query-param="case_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tareas/eventos">
      <call-query href="getTareasEventos"/>
   </resource>
   <resource method="DELETE" path="/tareas/planificadas/sinorigen">
      <call-query href="delTareasSinOrigen">
         <with-param name="empr_id" query-param="empr_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tareas/eventos/{empr_id}">
      <call-query href="getTareasEventos">
         <with-param name="empr_id" query-param="empr_id"/>
      </call-query>
   </resource>
   <resource method="POST" path="/hitos">
      <call-query href="setHito">
         <with-param name="numero" query-param="numero"/>
         <with-param name="fec_inicio" query-param="fec_inicio"/>
         <with-param name="objetivo" query-param="objetivo"/>
         <with-param name="esta_id" query-param="esta_id"/>
         <with-param name="petr_id" query-param="petr_id"/>
         <with-param name="descripcion" query-param="descripcion"/>
         <with-param name="user_id" query-param="user_id"/>
         <with-param name="unidad_tiempo" query-param="unidad_tiempo"/>
         <with-param name="documento" query-param="documento"/>
         <with-param name="nombre_documento" query-param="nombre_documento"/>
      </call-query>
   </resource>
   <resource method="GET" path="/pedidostrabajo/hitos/{petr_id}">
      <call-query href="getHitos">
         <with-param name="petr_id" query-param="petr_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/hitos/{hito_id}">
      <call-query href="getHito">
         <with-param name="hito_id" query-param="hito_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/petrid/hito/{hito_id}">
      <call-query href="getPetrIdXHitoId">
         <with-param name="hito_id" query-param="hito_id"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tareas/kpi/basico/desde/{desde}/hasta/{hasta}/usuario/{usuario}/cliente/{cliente}/empresa/{empr_id}">
      <call-query href="getKpiBasico">
         <with-param name="empr_id" query-param="empr_id"/>
         <with-param name="usuario" query-param="usuario"/>
         <with-param name="cliente" query-param="cliente"/>
         <with-param name="desde" query-param="desde"/>
         <with-param name="hasta" query-param="hasta"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tarea/planificada/{tapl_id}">
      <call-query href="getTareaPlanificada">
         <with-param name="tapl_id" query-param="tapl_id"/>
      </call-query>
   </resource>
   <resource method="PUT" path="/tarea/iniciar">
      <call-query href="updateFec_inicio_TareaPlanificada">
         <with-param name="fec_inicio" query-param="fec_inicio"/>
         <with-param name="case_id" query-param="case_id"/>
         <with-param name="estado" query-param="estado"/>
      </call-query>
   </resource>
   <resource method="PUT" path="/tarea/finalizar">
      <call-query href="updateFec_fin_TareaPlanificada">
         <with-param name="fec_fin" query-param="fec_fin"/>
         <with-param name="case_id" query-param="case_id"/>
         <with-param name="estado" query-param="estado"/>
      </call-query>
   </resource>
   <resource method="GET" path="/tareas/eventos/empresa/{empr_id}?rec_id_list={rec_id_list}">
      <call-query href="getTareasXRecursos">
         <with-param name="empr_id" query-param="empr_id"/>
         <with-param name="rec_id_list" query-param="rec_id_list"/>
      </call-query>
   </resource>
</data>
